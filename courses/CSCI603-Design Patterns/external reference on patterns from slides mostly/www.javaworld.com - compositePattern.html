<html><head><title>http://www.javaworld.com/javaworld/jw-09-2002/jw-0913-designpatterns.html</title>
</head>
<base href="http://www.javaworld.com/javaworld/jw-09-2002/jw-0913-designpatterns.html">
<body bgcolor="#FFFFFF">
<font size="1">Sponsored by:</font><BR>
<A HREF="http://ad.doubleclick.net/jump/idg.us.nwf.jw_core/jw_printer;pos=top;sz=728x90;tile=1;ord=1386124141?">
<IMG SRC="http://ad.doubleclick.net/ad/idg.us.nwf.jw_core/jw_printer;pos=top;sz=728x90;tile=1;ord=1386124141?" border=0 height="90" width="728"></A>
<p>
<IMG SRC="http://www.javaworld.com/includes/styles/i/javaworld-logo-wht-bg.gif" WIDTH="173" HEIGHT="57" ALT="From JavaWorld:"><br>
<BR>
<font size="-1">This story appeared on JavaWorld at<BR>
http://www.javaworld.com/javaworld/jw-09-2002/jw-0913-designpatterns.html<P></font>
                                                      <!--startindex-->                           <a id="top" name="top"></a><h1>A look at the Composite design pattern</h1>                           <H3>Treat primitive and composite objects the same way</H3>                           <p class="byline">By&nbsp;David Geary,&nbsp;JavaWorld.com,&nbsp;09/13/02</p>                           <!--#include virtual="/includes/community/storytools_bar_top.html"-->                                                      <!-- CONTENT GOES HERE-->                           <!--#set var="pages" value="5" --><!--#include virtual="/cgi-bin/pgnav05.pl?pageof=yes&pages=${pages}&${compare}" --><!--#if expr="${compare} = /^page\=1$/ || ${compare} = /^page\=full/" -->                           <p class="first">The other day I was listening to National Public Radio's <em><a href="#resources">Car Talk</a>,</em> a popular weekly broadcast during which callers ask questions about their vehicles. Before every program break, the show's                              hosts ask callers to dial 1-800-CAR-TALK, which corresponds to 1-800-227-8255. Of course, the former proves much easier to                              remember than the latter, in part because the words "CAR TALK" are a composite: two words that represent seven digits. Humans                              generally find it easier to deal with composites, rather than their individual components. Likewise, when you develop object-oriented                              software, it's often convenient to manipulate composites just like you manipulate individual components. That premise represents                              the fundamental principle of the Composite design pattern, the topic of this <strong>Java Design Patterns</strong> installment.                           </p>                           <h3>The Composite pattern</h3>                           <p>Before we dive into the Composite pattern, I must first define <em>composite objects:</em> objects that contain other objects; for example, a drawing may be composed of graphic primitives, such as lines, circles,                              rectangles, text, and so on.                           </p>                           <p>Java developers need the Composite pattern because we often must manipulate composites exactly the same way we manipulate                              primitive objects. For example, graphic primitives such as lines or text must be drawn, moved, and resized. But we also want                              to perform the same operation on composites, such as drawings, that are composed of those primitives. Ideally, we'd like to                              perform operations on both primitive objects and composites in exactly the same manner, <em>without distinguishing between the two.</em> If we must distinguish between primitive objects and composites to perform the same operations on those two types of objects,                              our code would become more complex and more difficult to implement, maintain, and extend.                           </p>                           <p>In <a href="#resources"><em>Design Patterns</em></a>, the authors describe the Composite pattern like this:                           </p>                           <blockquote>Compose objects into tree structures to represent part-whole hierarchies. Composite lets clients treat individual objects                              and compositions of objects uniformly.                           </blockquote><br><br>                            <p>Implementing the Composite pattern is easy. Composite classes extend a base class that represents primitive objects. Figure                              1 shows a class diagram that illustrates the Composite pattern's structure.                           </p>                           <p><img height="337" src="images/jw-0913-designpatternsf1.jpg" width="480"></p>                           <p><strong>Figure 1. A Composite pattern class diagram</strong></p><br><br>                            <p>In Figure 1's class diagram, I used class names from <em>Design Pattern'</em>s Composite pattern discussion: <code>Component</code> represents a base class (or possibly an interface) for primitive objects, and <code>Composite</code> represents a composite class. For example, the <code>Component</code> class might represent a base class for graphic primitives, whereas the <code>Composite</code> class might represent a <code>Drawing</code> class. Figure 1's <code>Leaf</code> class represents a concrete primitive object; for example, a <code>Line</code> class or a <code>Text</code> class. The <code>Operation1()</code> and <code>Operation2()</code> methods represent domain-specific methods implemented by both the <code>Component</code> and <code>Composite</code> classes.                           </p>                           <p>The <code>Composite</code> class maintains a collection of components. Typically, <code>Composite</code> methods are implemented by iterating over that collection and invoking the appropriate method for each <code>Component</code> in the collection. For example, a <code>Drawing</code> class might implement its <code>draw()</code> method like this:                           </p>                           <div id="codewrap">                              <div id="codewrap42"><pre>// This method is a Composite methodpublic void draw() {   // Iterate over the components   for(int i=0; i &lt; getComponentCount(); ++i) {      // Obtain a reference to the component and invoke its draw method      Component component = getComponent(i);      component.draw();      }}</pre></div>                           </div><br><br>                            <p>For every method implemented in the <code>Component</code> class, the <code>Composite</code> class implements a method with the same signature that iterates over the composite's components, as illustrated by the <code>draw()</code> method listed above.                           </p>                           <p>The <code>Composite</code> class extends the <code>Component</code> class, so you can pass a composite to a method that expects a component; for example, consider the following method:                           </p>                           <div id="codewrap">                              <div id="codewrap52"><pre>// This method is implemented in a class that's unrelated to the// Component and Composite classespublic void repaint(Component component) {   // The component can be a composite, but since it extends   // the Component class, this method need not   //  distinguish between components and composites   component.draw();}</pre></div>                           </div><br><br>                            <p>The preceding method is passed a component&#8212;either a simple component or a composit&#8212;then it invokes that component's <code>draw()</code> method. Because the <code>Composite</code> class extends <code>Component</code>, the <code>repaint()</code> method need not distinguish between components and composites&#8212;it simply invokes the <code>draw()</code> method for the component (or composite).                           </p>                           <p>Figure 1's Composite pattern class diagram does illustrate one problem with the pattern: you must distinguish between components                              and composites when you reference a <code>Component</code>, and you must invoke a composite-specific method, such as <code>addComponent()</code>. You typically fulfill that requirement by adding a method, such as <code>isComposite()</code>, to the <code>Component</code> class. That method returns <code>false</code> for components and is overridden in the <code>Composite</code> class to return <code>true</code>. Additionally, you must also cast the <code>Component</code> reference to a <code>Composite</code> instance, like this:                           </p>                           <div id="codewrap">                              <div id="codewrap71"><pre>...if(component.isComposite()) {   Composite composite = (Composite)component;   composite.addComponent(someComponentThatCouldBeAComposite);}...</pre></div>                           </div><br><br>                            <p>Notice that the <code>addComponent()</code> method is passed a <code>Component</code> reference, which can be either a primitive component or a composite. Because that component can be a composite, you can compose                              components into a tree structure, as indicated by the aforementioned quote from <em>Design Patterns</em>.                           </p>                           <p>Figure 2 shows an alternative Composite pattern implementation.</p>                           <p><img height="369" src="images/jw-0913-designpatternsf2.jpg" width="494"></p>                           <p><strong>Figure 2. An alternative Composite pattern class diagram</strong></p><br><br>                            <p>If you implement Figure 2's Composite pattern, you don't ever have to distinguish between components and composites, and you                              don't have to cast a <code>Component</code> reference to a <code>Composite</code> instance. So the code fragment listed above reduces to a single line:                           </p>                           <div id="codewrap">                              <div id="codewrap88"><pre>...component.addComponent(someComponentThatCouldBeAComposite);...</pre></div>                           </div><br><br>                            <p>But, if the <code>Component</code> reference in the preceding code fragment does not refer to a <code>Composite</code>, what should the <code>addComponent()</code> do? That's a major point of contention with Figure 2's Composite pattern implementation. Because primitive components do                              not contain other components, adding a component to another component makes no sense, so the <code>Component.addComponent()</code> method can either fail silently or throw an exception. Typically, adding a component to another primitive component is considered                              an error, so throwing an exception is perhaps the best course of action.                              <!--#include virtual="/cgi-bin/pgnav.pl?cont=yes&pages=${pages}&${compare}"-->                           </p><!--#endif --><!--#if expr="${compare} = /^page\=2$/ || ${compare} = /^page\=full/" -->                           <p>So which Composite pattern implementation&#8212;the one in Figure 1 or the one in Figure 2&#8212;works best? That's always a topic of                              great debate among Composite pattern implementers; <em>Design Patterns</em> prefers the Figure 2 implementation because you never need to distinguish between components and containers, and you never                              need to perform a cast. Personally, I prefer Figure 1's implementation, because I have a strong aversion to implementing methods                              in a class that don't make sense for that object type.                           </p>                           <p>Now that you understand the Composite pattern and how you can implement it, let's examine a Composite pattern example with                              the Apache Struts JavaServer Pages (JSP) framework.                           </p><!--#if expr="${compare} != /^page\=full/" --><!--#endif -->                           <h3>The Composite pattern and Struts Tiles</h3>                           <p>The Apache Struts framework includes a JSP tag library, known as <a href="#resources">Tiles</a>, that lets you compose a Webpage from multiple JSPs. Tiles is actually an implementation of the J2EE (Java 2 Platform, Enterprise                              Edition) CompositeView pattern, itself based on the <em>Design Patterns</em> Composite pattern. Before we discuss the Composite pattern's relevance to the Tiles tag library, let's first review the rationale                              for Tiles, and how you use it. If you're already familiar with Struts Tiles, you can skim the following sections and commence                              reading at "Use the Composite Pattern with Struts Tiles."                           </p>                           <p><strong>Note:</strong> You can read more about the J2EE CompositeView pattern in my "<a href="http://www.javaworld.com/javaworld/jw-12-2001/jw-1228-jsptemplate.html">Web Application Components Made Easy with Composite View</a>" (<em>JavaWorld,</em> December 2001) article.                           </p>                           <p>Designers often construct Webpages with a set of discrete regions; for example, Figure 3's Webpage comprises a sidebar, header,                              content region, and footer.                           </p>                           <center>                              <p><a alt="Figure 3. The Composite pattern and Struts Tiles. Click on thumbnail to view full-size image. " href="images/jw-0913-designpatternsf3.jpg" target="new_window"><img height="244" src="images/jw-0913-designpatternsf3-th.jpg" width="400"></a></p>                              <p><strong>Figure 3. The Composite pattern and Struts Tiles. Click on thumbnail to view full-size image.</strong></p>                           </center>                           <p>Websites often include multiple Webpages with identical layouts, such as Figure 3's sidebar/header/content/footer layout.                              Struts Tiles lets you reuse both content and layout among multiple Webpages. Before we discuss that reuse, let's see how Figure                              3's layout is traditionally implemented with HTML alone.                           </p>                           <h4>Implement complex layouts by hand</h4>                           <p>Example 1 shows how you can implement Figure 3's Webpage with HTML:</p>                           <h4>Example 1. A complex layout implemented by hand</h4>                           <div id="codewrap">                              <div id="codewrap118"><pre>&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;html&gt;   &lt;head&gt;      &lt;title&gt;Implementing Complex Layouts by Hand&lt;/title&gt;   &lt;/head&gt;   &lt;body background='graphics/blueAndWhiteBackground.gif'&gt;      &lt;%-- One table lays out all of the content for this page --%&gt;      &lt;table width='100%' height='100%'&gt;         &lt;tr&gt;            &lt;%-- Sidebar section --%&gt;            &lt;td width='150' valign='top' align='left'&gt;               &lt;table&gt;                  &lt;tr&gt;                     <b>&lt;%-- Sidebar top --%&gt;</b>                     &lt;td width='150' height='65' valign='top' align='left'&gt;                        &lt;a href=''&gt;                           &lt;img src='graphics/flags/britain_flag.gif'/&gt;&lt;/a&gt;                        &lt;a href=''&gt;                           &lt;img src='graphics/flags/german_flag.gif'/&gt;&lt;/a&gt;                        &lt;a href=''&gt;                           &lt;img src='graphics/flags/chinese_flag.gif'/&gt;&lt;/a&gt;                     &lt;/td&gt;                  &lt;/tr&gt;                  &lt;tr&gt;                     <b>&lt;%-- Sidebar bottom --%&gt;</b>                     &lt;td&gt;                        &lt;font size='5'&gt;Links&lt;/font&gt;&lt;p&gt;                        &lt;a href=''&gt;Home&lt;/a&gt;&lt;br&gt;                        &lt;a href=''&gt;Products&lt;/a&gt;&lt;br&gt;                        &lt;a href=''&gt;Downloads&lt;/a&gt;&lt;br&gt;                        &lt;a href=''&gt;White papers&lt;/a&gt;&lt;br&gt;                        &lt;a href=''&gt;Contact us&lt;/a&gt;&lt;br&gt;                     &lt;/td&gt;                  &lt;/tr&gt;               &lt;/table&gt;            &lt;/td&gt;            <b>&lt;%-- Main content section --%&gt;</b>            &lt;td valign='top' height='100%' width='*'&gt;               &lt;table width='100%' height='100%'&gt;                  &lt;tr&gt;                     <b>&lt;%-- Header section --%&gt;</b>                     &lt;td valign='top' height='15%'&gt;                        &lt;font size='6'&gt;Welcome to Sabreware, Inc.&lt;/font&gt;                        &lt;hr&gt;                     &lt;/td&gt;                  &lt;tr&gt;                  &lt;tr&gt;                     <b>&lt;%-- Content section --%&gt;</b>                     &lt;td valign='top' height='*'&gt;                        &lt;font size='4'&gt;Page-specific content goes here&lt;/font&gt;                     &lt;/td&gt;                  &lt;/tr&gt;                  &lt;tr&gt;                     <b>&lt;%-- Footer section --%&gt;</b>                     &lt;td valign='bottom' height='15%'&gt;                        &lt;hr&gt;                        Thanks for stopping by!                     &lt;/td&gt;                  &lt;/tr&gt;               &lt;/table&gt;            &lt;/td&gt;         &lt;/tr&gt;      &lt;/table&gt;   &lt;/body&gt;&lt;/html&gt;</pre></div>                           </div><br><br>                            <p>The preceding JSP has two major drawbacks: First, the page's content is embedded in the JSP, so you cannot reuse any of it,                              even though the sidebar, header, and footer are likely to be the same across many Webpages. Second, the page's layout is also                              embedded in that JSP, so you likewise cannot reuse it even though many other Webpages in the same Website use the same layout.                              We can use the <code>&lt;jsp:include&gt;</code> action to remedy the first drawback, as I discuss next.                              <!--#include virtual="/cgi-bin/pgnav.pl?cont=yes&pages=${pages}&${compare}"-->                           </p><!--#endif --><!--#if expr="${compare} = /^page\=3$/ || ${compare} = /^page\=full/" -->                           <h4>Implement complex layouts with JSP includes</h4>                           <p>Example 2 shows an implementation of Figure 3's Webpage that uses <code>&lt;jsp:include&gt;</code>:                           </p>                           <h4>Example 2. A complex layout implemented with JSP includes</h4>                           <div id="codewrap">                              <div id="codewrap133"><pre>&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;html&gt;   &lt;head&gt;      &lt;title&gt;Implementing Complex Layouts by Hand&lt;/title&gt;   &lt;/head&gt;   &lt;body background='graphics/blueAndWhiteBackground.gif'&gt;      &lt;%-- One table lays out all of the content for this page --%&gt;      &lt;table width='100%' height='100%'&gt;         &lt;tr&gt;            &lt;%-- Sidebar section --%&gt;            &lt;td width='150' valign='top' align='left'&gt;               <b>&lt;jsp:include page='sidebar.jsp'/&gt;</b>            &lt;/td&gt;            &lt;%-- Main content section --%&gt;            &lt;td height='100%' width='*'&gt;               &lt;table width='100%' height='100%'&gt;                  &lt;tr&gt;                     &lt;%-- Header section --%&gt;                     &lt;td valign='top' height='15%'&gt;                        <b>&lt;jsp:include page='header.jsp'/&gt;</b>                     &lt;/td&gt;                  &lt;tr&gt;                  &lt;tr&gt;                     &lt;%-- Content section --%&gt;                     &lt;td valign='top' height='*'&gt;                        <b>&lt;jsp:include page='content.jsp'/&gt;</b>                     &lt;/td&gt;                  &lt;/tr&gt;                  &lt;tr&gt;                     &lt;%-- Footer section --%&gt;                     &lt;td valign='bottom' height='15%'&gt;                        <b>&lt;jsp:include page='footer.jsp'/&gt;</b>                     &lt;/td&gt;                  &lt;/tr&gt;               &lt;/table&gt;            &lt;/td&gt;         &lt;/tr&gt;      &lt;/table&gt;   &lt;/body&gt;&lt;/html&gt;</pre></div>                           </div><br><br>                            <p>The preceding JSP includes the content of other JSPs with <code>&lt;jsp:include&gt;</code>. Because I've encapsulated that content in separate JSPs, you can reuse it for other Webpages:                           </p><!--#if expr="${compare} != /^page\=full/" --><!--#endif -->                           <h4>Example 3. sidebar.jsp</h4>                           <div id="codewrap">                              <div id="codewrap143"><pre>&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;table width='100%'&gt;   &lt;tr&gt;      &lt;%-- Sidebar top component --%&gt;      &lt;td width='150' height='65' valign='top' align='left'&gt;        &lt;a href=''&gt;&lt;img src='graphics/flags/britain_flag.gif'/&gt;&lt;/a&gt;        &lt;a href=''&gt;&lt;img src='graphics/flags/german_flag.gif'/&gt;&lt;/a&gt;        &lt;a href=''&gt;&lt;img src='graphics/flags/chinese_flag.gif'/&gt;&lt;/a&gt;      &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;      &lt;%-- Sidebar bottom component --%&gt;      &lt;td&gt;         &lt;table&gt;            &lt;tr&gt;               &lt;td&gt;                  &lt;font size='5'&gt;Links&lt;/font&gt;&lt;p&gt;                  &lt;a href=''&gt;Home&lt;/a&gt;&lt;br&gt;                  &lt;a href=''&gt;Products&lt;/a&gt;&lt;br&gt;                  &lt;a href=''&gt;Downloads&lt;/a&gt;&lt;br&gt;                  &lt;a href=''&gt;White papers&lt;/a&gt;&lt;br&gt;                  &lt;a href=''&gt;Contact us&lt;/a&gt;&lt;br&gt;               &lt;/td&gt;            &lt;/tr&gt;         &lt;/table&gt;      &lt;/td&gt;   &lt;/tr&gt;&lt;/table&gt;</pre></div>                           </div><br><br>                            <p>For completeness, I've listed below the JSPs included by the preceding JSP:</p>                           <h4>Example 4. header.jsp</h4>                           <div id="codewrap">                              <div id="codewrap148"><pre>&lt;font size='6'&gt;Welcome to Sabreware, Inc.&lt;/font&gt;&lt;hr&gt;</pre></div>                           </div><br><br>                            <h4>Example 5. content.jsp</h4>                           <div id="codewrap">                              <div id="codewrap152"><pre>&lt;font size='4'&gt;Page-specific content goes here&lt;/font&gt;</pre></div>                           </div><br><br>                            <h4>Example 6. footer.jsp</h4>                           <div id="codewrap">                              <div id="codewrap156"><pre>&lt;hr&gt;Thanks for stopping by!</pre></div>                           </div><br><br>                            <p>Even though Example 2's JSP uses <code>&lt;jsp:include&gt;</code> to reuse <em>content,</em> you can't reuse the page's <em>layout</em> because it's hardcoded in that JSP. Struts Tiles lets you reuse both the content and the layout, as illustrated in the next                              section.                           </p>                           <h4>Implement complex layouts with Struts Tiles</h4>                           <p>Example 7 shows the Webpage in Figure 3 implemented with Struts Tiles:</p>                           <h4>Example 7. Use Struts Tiles to encapsulate layout</h4>                           <div id="codewrap">                              <div id="codewrap166"><pre>&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;%@ taglib uri='WEB-INF/tlds/struts-tiles.tld' prefix='tiles' %&gt;&lt;tiles:insert definition='sidebar-header-footer-definition'/&gt;</pre></div>                           </div><br><br>                            <p>The preceding JSP uses the <code>&lt;tiles:insert&gt;</code> tag to create Figure 3's JSP. That JSP is defined by a <em>tiles definition</em> named <code>sidebar-header-footer-definition</code>. That definition resides in the Tiles configuration file, which in this case is <code>WEB-INF/tiles-defs.xml</code>, listed in Example 8:                           </p>                           <h4>Example 8. WEB-INF/tiles-defs.xml</h4>                           <div id="codewrap">                              <div id="codewrap175"><pre>&lt;!DOCTYPE tiles-definitions PUBLIC  "-//Apache Software Foundation//DTD Tiles Configuration//EN"  "http://jakarta.apache.org/struts/dtds/tiles-config.dtd"&gt;&lt;tiles-definitions&gt;   &lt;definition  name='sidebar-header-footer-definition'                 path=<b>'header-footer-sidebar-layout.jsp'&gt;</b>      &lt;put name='sidebar' value='<b>sidebar.jsp</b>'/&gt;      &lt;put name='header'  value='<b>header.jsp</b>'/&gt;         &lt;put name='content' value='<b>content.jsp</b>'/&gt;         &lt;put name='footer'  value='<b>footer.jsp</b>'/&gt;      &lt;/definition&gt;&lt;/tiles-definitions&gt;</pre></div>                           </div><br><br>                            <p>The preceding Tiles definition specifies the page layout, encapsulated in <code>header-footer-sidebar-layout.jsp</code>, and the page's content, encapsulated in <code>sidebar.jsp</code>, <code>header.jsp</code>, <code>content.jsp</code>, and <code>footer.jsp</code>, as listed in Examples 3-6. Example 9 lists the JSP that defines the layout&#8212;<code>header-footer-sidebar-layout.jsp</code>:                           </p>                           <h4>Example 9. header-footer-sidebar-layout.jsp</h4>                           <div id="codewrap">                              <div id="codewrap191"><pre>&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;html&gt;   &lt;head&gt;      &lt;title&gt;Struts Tiles implements the Composite pattern&lt;/title&gt;   &lt;/head&gt;   &lt;body background='graphics/blueAndWhiteBackground.gif'&gt;      &lt;%@ taglib uri='/WEB-INF/tlds/struts-tiles.tld'               prefix='tiles'%&gt;      &lt;%-- One table lays out all of the content --%&gt;      &lt;table width='100%' height='100%'&gt;         &lt;%-- Sidebar section --%&gt;         &lt;tr&gt;            &lt;td width='150' valign='top' align='left'&gt;               <b>&lt;tiles:insert attribute='sidebar'/&gt;</b>            &lt;/td&gt;            &lt;%-- Main content section --%&gt;            &lt;td valign='top' height='100%' width='*'&gt;               &lt;table width='100%' height='100%'&gt;                  &lt;tr&gt;                     &lt;%-- Header section --%&gt;                     &lt;td height='15%'&gt;                        <b>&lt;tiles:insert attribute='header'/&gt;</b>                     &lt;/td&gt;                  &lt;tr&gt;                  &lt;tr&gt;                     &lt;%-- Content section --%&gt;                     &lt;td valign='top' height='*'&gt;                        <b>&lt;tiles:insert attribute='content'/&gt;</b>                     &lt;/td&gt;                  &lt;/tr&gt;                  &lt;tr&gt;                     &lt;%-- Footer section --%&gt;                     &lt;td valign='bottom' height='15%'&gt;                        <b>&lt;tiles:insert attribute='footer'/&gt;</b>                     &lt;/td&gt;                  &lt;/tr&gt;               &lt;/table&gt;            &lt;/td&gt;         &lt;/tr&gt;      &lt;/table&gt;   &lt;/body&gt;&lt;/html&gt;</pre></div>                           </div><br><br>                            <p>The preceding JSP encapsulates layout and inserts content according to the values specified for the sidebar, editor, content,                              and footer regions in the Tiles definition file, thus easing reuse for both the content and the layout. For example, you could                              define another Tiles definition with the same layout, the same sidebar, editor, and footer, but different content:                           </p>                           <div id="codewrap">                              <div id="codewrap199"><pre>&lt;tiles-definitions&gt;   &lt;definition  name=<b>'a-different-sidebar-header-footer-definition'</b>                 path='header-footer-sidebar-layout.jsp'&gt;      &lt;put name='sidebar' value='sidebar.jsp'/&gt;      &lt;put name='header'  value='header.jsp'/&gt;         &lt;put name='content' value='<b>someOtherContent.jsp</b>'/&gt;         &lt;put name='footer'  value='footer.jsp'/&gt;      &lt;/definition&gt;&lt;/tiles-definitions&gt;</pre></div>                           </div><br><br>                            <p>To create the JSP defined by the tiles definition <code>a-different-sidebar-header-footer-definition</code>, you use the <code>&lt;tiles:insert&gt;</code> tag, like this:                           </p>                           <div id="codewrap">                              <div id="codewrap207"><pre>&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;%@ taglib uri='WEB-INF/tlds/struts-tiles.tld' prefix='tiles' %&gt;&lt;tiles:insert definition=<b>'a-different-sidebar-header-footer-definition'/&gt;</b></pre></div>                           </div><br><br>                            <p>Thanks to Struts Tiles, you can reuse both content and layout, which proves invaluable for Websites with many JSPs that share                              layout and some content. But if you look closely at the code from Examples 7-9, you will notice that the layout for the sidebar                              region is hardcoded in <code>sidebar.jsp</code>, which is listed in Example 3. That means you cannot reuse that layout. Fortunately, the Tiles tag library implements the                              Composite pattern, which lets us specify a tiles definition&#8212;instead of a JSP&#8212;for a region. In the next section, I explain                              how to use that Composite pattern implementation.                           </p>                           <h4>Use the Composite pattern with Struts Tiles</h4>                           <p>Struts Tiles implements the Composite pattern, where the <code>Component</code> class is represented by JSPs and the <code>Composite</code> class is represented by a Tiles definition. That implementation lets you specify either a JSP (a component) or a Tiles definition                              (a composite) as the content for a JSP's region. Example 10 illustrates that feature:                              <!--#include virtual="/cgi-bin/pgnav.pl?cont=yes&pages=${pages}&${compare}"-->                           </p><!--#endif --><!--#if expr="${compare} = /^page\=4$/ || ${compare} = /^page\=full/" -->                           <h4>Example 10. WEB-INF/tiles-defs.xml: Use the Composite pattern</h4>                           <div id="codewrap">                              <div id="codewrap218"><pre>&lt;!DOCTYPE tiles-definitions PUBLIC  "-//Apache Software Foundation//DTD Tiles Configuration//EN"  "http://jakarta.apache.org/struts/dtds/tiles-config.dtd"&gt;&lt;tiles-definitions&gt;   &lt;definition  name='<b>sidebar-definition</b>'                 path='<b>sidebar-layout.jsp</b>'&gt;      &lt;put name='top'    value=<b>'flags.jsp'</b>/&gt;      &lt;put name='bottom' value=<b>'sidebar-links.jsp'</b>/&gt;   &lt;/definition&gt;   &lt;definition  name='sidebar-header-footer-definition'                 path='header-footer-sidebar-layout.jsp'&gt;      &lt;put name='sidebar' value=<b>'sidebar-definition'</b>           type='definition'/&gt;      &lt;put name='header'  value='header.jsp'/&gt;      &lt;put name='content' value='content.jsp'/&gt;      &lt;put name='footer'  value='footer.jsp'/&gt;   &lt;/definition&gt;&lt;/tiles-definitions&gt;</pre></div>                           </div><br><br>                            <p>The preceding Tiles configuration file defines two Tiles definitions: <code>sidebar-definition</code> and <code>sidebar-header-footer-definition</code>. The <code>sidebar-definition</code> is specified <em>as the value for the sidebar region</em> in the <code>sidebar-header-footer-definition</code>. You can specify it as such because Tiles implements the Composite pattern by letting Tiles specify a definition (a <code>Composite</code> that's a JSP collection) where you would normally specify a single JSP (which is a <code>Component</code>).                           </p>                           <p>The sidebar's layout is encapsulated in Example 11's <code>sidebar-layout.jsp</code>:                           </p><!--#if expr="${compare} != /^page\=full/" --><!--#endif -->                           <h4>Example 11. sidebar-layout.jsp</h4>                           <div id="codewrap">                              <div id="codewrap237"><pre>&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;%@ taglib uri='/WEB-INF/tlds/struts-tiles.tld' prefix='tiles'%&gt;&lt;table width='100%'&gt;   &lt;tr&gt;      &lt;td width='150' height='65' valign='top' align='left'&gt;         <b>&lt;tiles:insert attribute='top'/&gt;</b>      &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;      &lt;td&gt;         &lt;table&gt;            &lt;tr&gt;               &lt;td&gt;<b>&lt;tiles:insert attribute='bottom'/&gt;</b>&lt;/td&gt;            &lt;/tr&gt;         &lt;/table&gt;      &lt;/td&gt;   &lt;/tr&gt;&lt;/table&gt;</pre></div>                           </div><br><br>                            <p>Example 12 lists <code>flags.jsp</code>, specified as the content for the sidebar's <code>top</code> region, and Example 13 lists <code>sidebar-links.jsp</code>, specified as the sidebar's <code>bottom</code> region:                           </p>                           <h4>Example 12. flags.jsp</h4>                           <div id="codewrap">                              <div id="codewrap248"><pre>&lt;table&gt;   &lt;tr&gt;&lt;td&gt;      &lt;a href=''&gt;&lt;img src='graphics/flags/britain_flag.gif'/&gt;&lt;/a&gt;      &lt;a href=''&gt;&lt;img src='graphics/flags/german_flag.gif'/&gt;&lt;/a&gt;      &lt;a href=''&gt;&lt;img src='graphics/flags/chinese_flag.gif'/&gt;&lt;/a&gt;   &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</pre></div>                           </div><br><br>                            <h4>Example 13. sidebar-links.jsp</h4>                           <div id="codewrap">                              <div id="codewrap252"><pre>&lt;p&gt;&lt;font size='5'&gt;Links&lt;/font&gt;&lt;p&gt;&lt;a href=''&gt;Home&lt;/a&gt;&lt;br&gt;&lt;a href=''&gt;Products&lt;/a&gt;&lt;br&gt;&lt;a href=''&gt;Downloads&lt;/a&gt;&lt;br&gt;&lt;a href=''&gt;White papers&lt;/a&gt;&lt;br&gt;&lt;a href=''&gt;Contact us&lt;/a&gt;&lt;br&gt;</pre></div>                           </div><br><br>                            <p>Now the <code>sidebar-definition</code> can define other regions with a top and bottom component, although you should probably rename that definition to something                              more generic like <code>top-bottom-definition</code>.                           </p>                           <h3>It's all composites these days</h3>                           <p>The Composite pattern is popular with presentation frameworks, such as Swing and Struts, because it lets you nest containers                              by treating components and their containers exactly the same. Struts Tiles uses the Composite pattern to specify a simple                              JSP or a Tiles definition&#8212;which is a collection of JSPs&#8212;as a tile's content. That's a powerful capability that eases management                              of large Websites with different layouts.                           </p>                           <p>The "Homework from Last Time" section below expands on this article's discussion by internationalizing the preceding application                              with a Struts action and the JSP Standard Tag Library (JSTL).                              <!--#include virtual="/cgi-bin/pgnav.pl?cont=yes&pages=${pages}&${compare}"-->                           </p><!--#endif --><!--#if expr="${compare} = /^page\=5$/ || ${compare} = /^page\=full/" -->                           <h3>Homework</h3>                           <p>Discuss how Swing implements the composite pattern with the <code>Component</code> and <code>Container</code> classes.                           </p>                           <h3>Homework from last time</h3>                           <p>Your last assignment asked you to download Struts from <a href="http://jakarta.apache.org/struts/index.html">http://jakarta.apache.org/struts/index.html</a> and implement your own Struts action class.                           </p><!--#if expr="${compare} != /^page\=full/" --><!--#endif -->                           <p>For this assignment, I decided to implement a Struts action in conjunction with the JSP Standard Tag Library (JSTL) to internationalize                              Example 1's Web application. Although Struts provides the necessary infrastructure to internationalize your Web applications,                              you should use JSTL for that task, because JSTL is a standard. At some point, the Struts internationalization capabilities                              will probably be deprecated or integrated with JSTL.                           </p>                           <p>After I internationalized Example 1's Web application with a Struts action and JSTL, I localized that application for Chinese.                              Figure H1 illustrates the result.                           </p>                           <p><strong>Note:</strong> I don't know a single word of Chinese, let alone how to write the language, so Figure H1's Chinese is fabricated from arbitrary                              Unicode strings. But it looks cool, regardless.                           </p>                           <center>                              <p><a alt="Figure H1. Internationalization with a Struts Action. Click on thumbnail to view full-size image. " href="images/jw-0913-designpatternsfh1.jpg" target="new_window"><img height="245" src="images/jw-0913-designpatternsfh1-th.jpg" width="400"></a></p>                              <p><strong>Figure H1. Internationalization with a Struts Action. Click on thumbnail to view full-size image.</strong></p>                           </center>                           <p>Notice I specified the <code>href</code> attributes in Example 12's <code>flags.jsp</code> as empty strings, so when you click on the flags, the servlet container reloads the current JSP. Therefore, the first step                              towards internationalizing the Web application is to specify a URL for those attributes, as listed in Example H1:                           </p>                           <h4>Example H1. flags.jsp</h4>                           <div id="codewrap">                              <div id="codewrap282"><pre>&lt;table&gt;   &lt;tr&gt;&lt;td&gt;      &lt;a href='<b>flags.do?locale=en-GB&amp;fwdPage=&lt;%=request.getServletPath()%&gt;</b>'&gt;         &lt;img src='graphics/flags/britain_flag.gif'/&gt;&lt;/a&gt;      &lt;a href='<b>flags.do?locale=de-DE&amp;fwdPage=&lt;%=request.getServletPath()%&gt;</b>'&gt;         &lt;img src='graphics/flags/german_flag.gif'/&gt;&lt;/a&gt;      &lt;a href='<b>flags.do?locale=zh-ZH&amp;fwdPage=&lt;%=request.getServletPath()%&gt;</b>'&gt;         &lt;img src='graphics/flags/chinese_flag.gif'/&gt;&lt;/a&gt;   &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</pre></div>                           </div><br><br>                            <p>The URL for each <code>href</code> attribute is the same: <code>flags.do</code>. Two request parameters are tacked onto that URL: one for the locale corresponding to the flag and another that represents                              the current JSP's path. You obtain the latter request parameter by invoking the <code>Http.ServletRequest.getServletPath()</code> method.                           </p>                           <p>In the application's deployment descriptor, I mapped all URLs ending in <code>.do</code> to the Struts action servlet, like this:                           </p>                           <h4>Example H2. WEB-INF/web.xml (Excerpt)</h4>                           <div id="codewrap">                              <div id="codewrap295"><pre>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;!DOCTYPE web-app  PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN"  "http://java.sun.com/j2ee/dtds/web-app_2.2.dtd"&gt;&lt;web-app&gt;     &lt;!-- Action Servlet Configuration --&gt;     &lt;servlet&gt;       &lt;servlet-name&gt;          <b>action</b>       &lt;/servlet-name&gt;       &lt;servlet-class&gt;         <b>org.apache.struts.action.ActionServlet</b>       &lt;/servlet-class&gt;       ...       &lt;load-on-startup/&gt;     &lt;/servlet&gt;     &lt;!-- Action Servlet Mapping --&gt;     &lt;servlet-mapping&gt;       &lt;servlet-name&gt;<b>action</b>&lt;/servlet-name&gt;       &lt;url-pattern&gt;<b>*.do</b>&lt;/url-pattern&gt;     &lt;/servlet-mapping&gt;     ...&lt;/web-app&gt;</pre></div>                           </div><br><br>                            <p><strong>Note:</strong> See my "<a href="http://www.javaworld.com/javaworld/jw-06-2002/jw-0628-designpatterns.html">Take Command of Your Software</a>" (<em>JavaWorld,</em> June 2002) article for more information about Struts and the Struts action servlet.                           </p>                           <p>Next, I mapped the path <code>/flags</code> to the Struts action <code>actions.FlagAction</code> in the Struts configuration file, listed in Example H3:                           </p>                           <h4>Example H3. WEB-INF/struts-config.xml</h4>                           <div id="codewrap">                              <div id="codewrap310"><pre>&lt;?xml version="1.0" encoding="ISO-8859-1" ?&gt;&lt;!DOCTYPE struts-config PUBLIC  "-//Apache Software Foundation//DTD Struts Configuration 1.1//EN"  "http://jakarta.apache.org/struts/dtds/struts-config_1_1.dtd"&gt;&lt;struts-config&gt;   <b>&lt;action-mappings&gt;      &lt;action path='/flags' type='actions.FlagAction'/&gt;   &lt;/action-mappings&gt;</b>   &lt;plug-in className="org.apache.struts.tiles.TilesPlugin" &gt;        &lt;set-property property="definitions-config"                        value="/WEB-INF/tiles-defs.xml" /&gt;        &lt;set-property property="definitions-debug" value="2" /&gt;        &lt;set-property property="definitions-parser-details"                        value="2" /&gt;        &lt;set-property property="definitions-parser-validate"                        value="true" /&gt;   &lt;/plug-in&gt;&lt;/struts-config&gt;</pre></div>                           </div><br><br>                            <p>Because of that mapping, the URL <code>flags.do</code> causes the Struts action servlet to invoke the <code>actions.FlagAction.execute()</code> method; therefore, clicking on a flag will invoke the <code>actions.FlagAction.execute()</code> method. Example H4 lists the <code>actions.FlagAction</code> class:                           </p>                           <h4>Example H4. WEB-INF/classes/actions/FlagAction.java</h4>                           <div id="codewrap">                              <div id="codewrap320"><pre>package actions;import javax.servlet.ServletContext;import javax.servlet.http.*;import org.apache.struts.action.*;<b>import javax.servlet.jsp.jstl.core.Config;</b>public class FlagAction extends Action {   public ActionForward execute(ActionMapping mapping,                                 ActionForm form,                                HttpServletRequest request,                                 HttpServletResponse response)                         throws java.io.IOException, javax.servlet.ServletException {      String locale = request.getParameter("locale");      <b>Config.set(getServlet().getServletContext(),                  Config.FMT_LOCALE, locale);</b>      return new ActionForward(request.getParameter("fwdPage"));   }}</pre></div>                           </div><br><br>                            <p>The <code>actions.FlagAction.execute()</code> method obtains a reference to the <code>locale</code> request parameter and passes that value to the JSTL <code>Config</code> class's <code>set()</code> method. That method stores the string representing the locale in the <code>FMT_LOCALE</code> configuration setting, which JSTL uses to localize text and format numbers, currencies, percents, and dates.                           </p>                           <p>Now that I've specified a locale for JSTL internationalization actions, I next specify a resource bundle in the application's                              deployment descriptor, an excerpt of which is listed in Example H5:                           </p>                           <h4>Example H5. WEB-INF/web.xml (Excerpt)</h4>                           <div id="codewrap">                              <div id="codewrap333"><pre>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;!DOCTYPE web-app  PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN"  "http://java.sun.com/j2ee/dtds/web-app_2.2.dtd"&gt;&lt;web-app&gt;     &lt;!-- Define the basename for a resource bundle for I18N --&gt;   &lt;context-param&gt;      &lt;param-name&gt;         <b>javax.servlet.jsp.jstl.fmt.localizationContext</b>      &lt;/param-name&gt;      &lt;param-value&gt;         <b>resources</b>      &lt;/param-value&gt;   &lt;/context-param&gt;   ...&lt;/web-app&gt;</pre></div>                           </div><br><br>                            <p>The <em>resource bundle basename</em> <code>resources</code> is specified for the <code>javax.servlet.jsp.jstl.fmt.localizationContext</code> context-initialization parameter. That means JSTL will search for a file named <code><em>resources</em>_en.properties</code> when the locale is set to British English (<code>en-GB</code>) and <code><em>resources</em>_zh.properties</code> when the locale is set to Chinese (<code>zh-ZH</code>).                           </p>                           <p>Now that I've specified a resource bundle and a locale for the JSTL internationalization actions, I next modify the JSP files                              to use those actions, as Examples H6-H9 demonstrate:                           </p>                           <h4>Example H6. sidebar-links.jsp</h4>                           <div id="codewrap">                              <div id="codewrap350"><pre>&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;%@ taglib uri='http://java.sun.com/jstl/fmt' prefix='fmt' %&gt;&lt;p&gt;&lt;font size='5'&gt;&lt;fmt:message key='sidebar.heading'/&gt;&lt;/font&gt;&lt;p&gt;&lt;a href='index.jsp'&gt;&lt;fmt:message key='sidebar.link.1.name'/&gt;&lt;/a&gt;&lt;br&gt;&lt;a href='products.jsp'&gt;&lt;fmt:message key='sidebar.link.2.name'/&gt;&lt;/a&gt;&lt;br&gt;&lt;a href='downloads.jsp'&gt;&lt;fmt:message key='sidebar.link.3.name'/&gt;&lt;/a&gt;&lt;br&gt;&lt;a href='sales.jsp'&gt;&lt;fmt:message key='sidebar.link.4.name'/&gt;&lt;/a&gt;&lt;br&gt;&lt;a href='contact.jsp'&gt;&lt;fmt:message key='sidebar.link.5.name'/&gt;&lt;/a&gt;&lt;br&gt;</pre></div>                           </div><br><br>                            <h4>Example H7. header.jsp</h4>                           <div id="codewrap">                              <div id="codewrap354"><pre>&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;%@ taglib uri='http://java.sun.com/jstl/fmt' prefix='fmt' %&gt;&lt;font size='6'&gt;&lt;fmt:message key='header.heading'/&gt;&lt;/font&gt;&lt;hr&gt;</pre></div>                           </div><br><br>                            <h4>Example H8. content.jsp</h4>                           <div id="codewrap">                              <div id="codewrap358"><pre>&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;%@ taglib uri='http://java.sun.com/jstl/fmt' prefix='fmt' %&gt;&lt;font size='4'&gt;&lt;fmt:message key='content.heading'/&gt;&lt;/font&gt;</pre></div>                           </div><br><br>                            <h4>Example H9. footer.jsp</h4>                           <div id="codewrap">                              <div id="codewrap362"><pre>&lt;%@ page contentType='text/html; charset=UTF-8' %&gt;&lt;%@ taglib uri='http://java.sun.com/jstl/fmt' prefix='fmt' %&gt;&lt;hr&gt;&lt;fmt:message key='footer.message'/&gt;</pre></div>                           </div><br><br>                            <p>Examples H6-H9's JSPs use the JSTL <code>&lt;fmt:message&gt;</code> action to extract Unicode strings from the resource bundle specified in the deployment descriptor. Examples H10 and H11 list                              the resource bundles for English and Chinese, respectively:                           </p>                           <h4>Example H10. WEB-INF/classes/resources_en.properties</h4>                           <div id="codewrap">                              <div id="codewrap368"><pre>header.heading=Welcome to Sabreware, Inc.content.heading=Page-specific content goes herefooter.message=Thanks for stopping by!sidebar.heading=Linkssidebar.link.1.name=Homesidebar.link.2.name=Productssidebar.link.3.name=Downloadssidebar.link.4.name=Salessidebar.link.5.name=Contact Us</pre></div>                           </div><br><br>                            <h4>Example H11. WEB-INF/classes/resources_zh.properties</h4>                           <div id="codewrap">                              <div id="codewrap372"><pre>header.heading=\u5bc6\u7801\u63d0\u793a\u95ee\u9898 Sabreware, Inc.content.heading=\u6709\u6548\u671f\u9650footer.message=\u4eca\u5929\u662fsidebar.heading=\u8fd9\u91ccsidebar.link.1.name=\u767b\u5f55sidebar.link.2.name=\u540dsidebar.link.3.name=\u59d3sidebar.link.4.name=\u7701\u4efdsidebar.link.5.name=\u7501\u4cfe</pre></div>                           </div><br><br>                            <h3>Email</h3>                           <p>In an email to me, Joseph Friedman wrote:</p>                           <blockquote>In "<a href="http://www.javaworld.com/javaworld/jw-12-2001/jw-1214-designpatterns.html?">Decorate Your Java Code</a>" (<em>JavaWorld,</em> December 2001), you write:<br><br>                               <p>"The enclosing object&#8212;known as a decorator&#8212;conforms to the interface of the object it encloses, allowing the decorator to                                 be used as though it were an instance of the object it encloses."                              </p>                              <p>However, the code example decorates the <code>FileReader</code> with a <code>LineNumberReader</code> and calls <code>readLine()</code>, which is not in the <code>FileReader</code> interface; thus you are not using the <code>LineNumberReader</code> transparently.                              </p>                           </blockquote><br><br>                            <p>Both <code>FileReader</code> and <code>LineNumberReader</code> conform to the interface defined by the <code>Reader</code> class, which they both extend. The idea is that you can pass the decorator to any method that expects a reference to a <code>Reader</code>. Those methods remain blissfully ignorant of that decorator's special capabilities&#8212;in this case, the ability to read files                              and produce line numbers. However, if you know about those special capabilities, you can take advantage of them.                           </p>                           <p>The fact that the decorator possesses (one or more) methods that the decorated object lacks does not in any way violate the                              Decorator pattern's intent; in fact, that's the central feature of that pattern: to add functionality at runtime to an object                              by decorating objects recursively.                           </p>                           <p>If you look at <em>Design Patterns</em> page 173, you will see this:                           </p>                           <h3>About the author</h3>David                           Geary is the author of Core JSTL Mastering the JSP Standard Tag                           Library, which will be published this fall by                           Prentice-Hall and Sun Microsystems Press; Advanced JavaServer Pages (Prentice                           Hall, 2001; ISBN: 0130307041); and the Graphic Java series (Sun Microsystems                           Press). David has been developing object-oriented software with                           numerous object-oriented languages for 18 years. Since the GOF                           Design Patterns book was published in 1994, David has been                           an active proponent of design patterns, and has used and                           implemented design patterns in Smalltalk, C++, and Java. In 1997,                           David began working full-time as an author and occasional speaker                           and consultant. David is a member of the expert groups defining the                           JSP standard custom tag library and JavaServer Faces, and is a                           contributor to the Apache Struts JSP framework.                           <p><a target="blank" href="http://www.javaworld.com/channel_content/jw-core-index.html">Read more about Core Java</a> in JavaWorld's Core Java section.                           </p>                           <blockquote>Decorator subclasses are free to add operations for specific functionality. For example, <code>ScrollDecorator</code>'s <code>ScrollTo</code> operation lets other objects scroll the interface *if* they know there happens to be a <code>ScrollDecorator</code> object in the interface.                           </blockquote><br><br><!--#endif --><!--#include virtual="/includes/global-pgnav.html" -->                                                      <p>
<font size="-1">All contents copyright 1995-2013 Java World, Inc. <a href='http://www.javaworld.com'>http://www.javaworld.com</a></font>
</body>
</html>
